language: node_js
node_js:
  - node

notifications:
  slack:
    on_success: always
    on_failure: always
  email:
    on_success: change
    on_failure: always

env:
  global:
  - COLLECTION_NAME='Books'
  - secure: "DFzzTuWY3zzMkX1ON2dPZ9it5MrBCSYlfPVdKiKfVWfEedeQThDKkPU/U/phvSE9xsias8+i2GKsxIW/vTz0InNibs6MLAatms93FF0dtndlKCaJHLykxDvJdRZAc6NtHyu9evG2rffBKkEu6eMNrcnBVh5B8nYIx//NNgCsVTZKBXmzMqq03Zx0ASYZplmm7wJxQetP5bh6txxp0Iab0vKYEIlp4MeBbiWGnjWw+GefNsFt9TgBNGg60FORexXuw/PZ4BPnO4FPiH9kryp4cDeQQNpCBStxZmr0HqVotxe5mZEGhevN4BgVep6otf6hpbDKbZengW4ap+RCS15eRQyNjdcd4xlfdLC1XCHtP3VQMu+17NrRFKOJ30sjByJpmzcTJGfWqOWhcGf05iY4ZGJkCjMpP/83q4j93EhUJHpo3eab1BgYuik8nYDmlI64K0e06YO3xIpXOU3EaQgwCaA38DNU1ZaCdojhXv0YvNtPBiJdLEoydq9yRrYYlTLrv8pW93WGAoGu+sbZC5yNHxl9JHuKBhkK30pv1QnRS7Tj+OcWPVpF9sqscz1ccmaCRgvRj6ucqRKMSPtUhljrbzV+NVurN6k0HuAm5DtZcfCmLcASxmynkmGsiff6AqAHT4jDEG2ygxokHBUL/0maYjDHc9C5TOfsQ/hj/4R0YCg=" # Facebook Email
  - secure: "l4gT/IuIsYRqmJqID/OKzpfeuTxVyi454IyOtNLqFLFruuC2fAlnavEy5RUvs/Mujs8t/xpm2NWVJGo8IKfbyOpKIadEQyrhb/FIM+wRneaP3+GxIBL7DPRgXcVAkQjLIs2i8cWvNR6Qbp2jz/HZik/Prt1Yv6Kbkh7o6UGNOH5xPnER58wqpbn8r5nZm4OCu0u1SCYncUnV4m2vdFvN9FlcQ4bKmsWYVYg0c0id2aKrEpSa2yfrQUyb7xS4WflzxQ452DqHbcxQrnF2m9vqIFakR+H6BdrWlkTATnKjY/xBldDTbK3Nq0VjPNX7qETyIQGvLXgUQhPT27CvPXh6mv3xumzoeIYjbyKbjdqkeckb0Nmrx0QZkC8SMCoLk//XcuyOydsndCnK6Q3WccU46KSWXYFWr+g1ol0jhtWbQNR20yDA1w2GawmVx4f6N6Bh3AuiOE5ebeLkFzWuMuVal5ZY16JnKxwG7xo2xLqf5GOL5JXGP0/zClRhU7UKIhXLrNS8d+hwJT3+HtnqjTsxI+ZAomEHuMz3Crh2vvRM4UirlnRx+pYykhU2CyhC6cO4sHtqRIanY3W/bsUnx5VmEw3SIhrEk2bX0+UannUDdxFfDaSgNnz4svOTksuP6DTYHVvtbJ01abTcv9qYdLP4aian7eHf+L3bLwX67GWJXp4=" # Facebook Password

jobs:
  include:
    - stages: "Tests"
      name: "Unit Tests"
      script:
      - npm test
    - script:
      - npx lerna bootstrap
      - npx lerna run build --parallel --stream
      - npx lerna run test:node --stream
      name: "NodeJS Integration Tests"
      # if: type IN (pull_request)
      env:
      - secure: "gijTdn4Kr3v8ylxTMGNNoFgNb8GOrYXAk9HnXDbQ13UEiqV47x68T6J7MFrD4CfNmd9tVLHiILjL/3tx5+5qYGZ9Fq1HAx8i9hZ/oHiVZhmO215YKv4ZPOxOhSQ1xBAP+4pio15nRn79943DAIuckUsNrqKqSot73N1wvkuQjOyf3DAyC+LLfkDYAr7bLaTcANWLiNBxqK6H4ndUWXcZwYbTmzF1W7KHBNX+zJetMHMz9UTOBW1jD1fUNoyyRh5zyWlJp16ZTo0Cxa/EVqzHcK6mrSM29W9uCbyvDrmk3xw6bWncCSGdUfaDk/uRxEiw+MgJRseTp7RiMX3Cn96ABKR/nfubB2wyBNib5+Lg17M9BZZGw2TeCXRZqFbE25BJDw2TH4N6EDUiipRqTu2C9Lc3qnQ6fXW5EMRqYfqBCcyPE+/oA3fLlilEvooobyC4kKBHa/xuVhroMvQg9ARqtPcP/gI96MlO3nh40W4Emxc2KUhQ7F0Zs3QfYqMTp17jD5Lx0xoe55+3Qv/hF9wvyJPvKMwlMv/F9YBWKgaSEdx2NBUB9salQSNxBQBwLkySrvtUlucI9T39/PGFo0Bo+LKIG+kxeKphse82ufh8ItNjd1nm/zPUxZ9b1UQgYn8+S3Itawulm61B26Tfpu2cWhFc4AQHpCzEGeBEefdmww0=" # App Key
      - secure: "H2w6CdG1wDJqwSLmkk+4/qXRMrAp2F+z1pf2JZmvrHXn6Iygdm18aYKXB6EqF5BzvQQgb3cVh9UgvtG+kAF328o+e5Pja6SMbSFSw9tvczS9ONq50QV+E8gKtQCpYct2Jv96KfkGk98YxQOnl/2j6kwcRatmxuRUkF/4E5wlKQiMqA5A2td+H/ZR6KOByRMijMw3trph4tbRsJGUEufNP6g5p3TivCikNGpuEKgPLTDs+VDChojHFQv9LDmMehUpIT1PFXxoS5uQHQMiTlpJm0ste7XUMtxXMpyiIxHAntQOkaua5Bwl+I8kE5qpFxUwR5Xm+6B805el7Rbbu9C+cy36l44N21ZsSTfZE3ZZrx5UCpZsoxenYzFdn2y1xyuuPNuME99l5+Tqx6bDhKZt3HLAxtBlpR1E4vrmt8QiCWz8+urDDS7qx5I6IOqdP8p8qC/BBDGasnmKPYcC+xRYQNeDNE0D34LwytSixRmxfHqKcFmzbHhVzc5/Uw2FGYsaBYfPXhC5dqqoh/wcSstQFQUzFLRP4q9jVClioP7JyeufBR1BBKvTO/232pQvnf4h/vaze+cNBTRXkMN6Eo/eNOkwt3vU+PQX4MCw34yWQrvGBmstvAgaRnfcvHPcLYZ3/otrGcxc2MAZBuKqQgWfeilMnDQPS+++FEfSSXMbP1Y=" # App Secret
      - secure: "Uvdq5bAcEH+TK29kX9fX4x2eZM7q8MKnjsyPxmwqhfUPrjC/mOLdQmgRjSJNFs1lYMswl/vy+RSvYF7a2z/RDLAzJ3jZk5WimfJk3ktlFootP/Qx4rxU1bHoGVkmpS7zQHcQ7+cXpLRXefOGKmCgeAC09uVbqna4qw1w97C0mQecCpFTPhkFasiEjAUdweIRhoQr0gz71kpydfk2L+F/v7SdjBMu2iUTOyRzhOlN4IHkrB63TDd2bRa1qU9kur6XJUJTFj7URm6njQpv0pShOmA6qL/IRrrtvkXRulINyAez6CIvYJF5/AM68XJPaxCRqD1CClPv0cncmnhAdpwD5QDPkyPxxe7vjTKTaEbpSjiJVOqPfN/0RStoUkgJZz1RC1iSCXQ2yVXerTyJyxKxyU/G4tV+7ioeEYnTXsgTb+2Qz2t1gpigtiYRZrC2FrgiYueyW6ddomZMZCrryo/WHxM2CFlq1mg1u+d9i+axzberBAjxp9HQdqVh8ygHTHVOHmuuaiZD4suQ1Yi+KZY9rSOp0skUZJQuAunjhJlmm+6F5vH9g6q8XNDfFd+NXdaxznqDCv5ah5kV6gBH2RjFdgOVWMjnG14mEWfFPLY1C2dhYVWrQL1kp7/upIwY8lBmKsLTTxlMca7/o4hDpJOs/hXZWd8uUErkSQWGBfXC2Ig=" # Master Secret
      # - secure: "UH540ZcktciYMXg4pQgkucC+Ig4bHc1Wn6EQWn/unS5ZUQYPcgoTcU5d1BDiVwADZNB1ud4hn3Rn9vE1n+rrqEOQ0eIDrxNJADuTN8qLpQ+9b8m1uGVIBqLX31KnbGYnpED5hftW+yLxyLvxWGuK0Xrfun3Qk4SbN947nYwfhpmhQLvivCafIV8hEE4gW6sQy5JzMEWXUBEMWbxsPxMb+Pq1QGB0O0LQZ9aIZzVY/CLi3l1xuf4PfBobl3B3rySq8OSv0l28akyVMNiRtsuZOLP3zy52rkGIcJMaYEq9suPmUGYjFg5/HF2dnS7NwFmDOEEIZarTm5KNsuqsc31tUMNaDggb7LLsxPjIPU0ItUheRPwRxKZvzZyuQGwu4NXWVjotOYHTcmaT0Y91osSaQudyyOKuxod0TyX8NePGnXNVgBIpIXAiKIr22d0Uw2SxPniZ4g3ZwKjS+ShQvM6VuI8uutm0gROKuKMbr5w2301Y/UfuKPf1xfo/dQFUEcYLbpKWwjydb3TPfZg0/sF/Fv915KWunPrRoOAZIgiepBlYIoVBzsc13Fwkm1xxF9/2PFt6zlck5j1szu/FWmyaETeXzYq3B+6RSzqMVO5WPi426vNdT4rs0o+6rfLjyw1nPCddVSbU3XKW0sTN9sMIKvpUMCmTr+M2s7J+KbidN2I=" # Auth Service Id
      # - secure: "ZbyS1q3N/26m/BcginZ0wXU/8Y+6fSMOyWHF/4NEcjf8fUospMmcg43PchlHboIQOiWOFZAl8ZLn684QxGHeoy6GUrAjCA4GwjT0M7bsjthIM40TC0IRFGcChBUzPHY4+M6LtOKmYKa9mA3otoJZ36zN3xHGCdDCU7J0odJ6eJjdN7B7KmhFjg4zy+15/Yw7bhEs9+hpQQz+kaRnElkQkUWQPXWnOwZmEpNye2k31VZkQK654PdQkSq0j2Gm/1UxmuJbq4eGqYM0NIfMGHAvpcZw8InsLW1R23/JPRuztBRwFXvDPuw6rGNI+Aa2dx2bvL0RqevOXQ+hmQJ/zlI7mC4ozuOBeERqvJa/wI4n/gbX9tafflIdl4i6YtU1Pa4IUvlRyba0yscfq/f/dJqa7QfkIol4baxEyoMHL4eqNh0owFFrp6swWIi9oZJhUxrD9/T1BUSqO2/lHqh4VwmMndKI5c6Rw7TVE3f6th3xYYtJ4gsPuMuWkml24Pz8r3PTpo73uv4OlZ7Iz9liTxwEHxWvBLTrrSFNsF1l8UaEdXCVmSJ+bJTOJm+U8VTojxiaLXyUSpyfig95IVVojvtz+ToRTDR1wyFSTlzK06o+5e0fm4gAJcIT1cJ04KQGh3Un8TFRg4cmsmS/2gQ7ZBiBXF2pWJpVmn+eBkuIPN7JFt4=" # No Refresh Token Auth Service Id
      # - secure: "vRmY5a46ltR04PZaUS+jsTUuZT/xvdQAAldXFADejNYLXzYpd+26QQIR9xk1WyBbiJKUc4A3o615spRjdzRayqqcm55F1LmNrpZDdtMzDfe6/o70EF/yhMrDmETVxHQHZsAxyfNI3IIkxGjYv3Wk1nUgIifC2taX5oRaaWN4c+XtN8uyj8nw9JJp/4M4+vCUtBwUQJBONMnCJkL0Rg0eKorV1hdVp2wo6xtn0LnMMepWouKiTzubJsaGEhl/PguogOyzXYdLIm1VFoWP7TNNPHx9TQuHt1sg6jfHKvKwHQmKiS2eLuZIDIkg+GkvNqdVg/KjSfxqoVOX7CfOZatEYQg54AVCsUshCXwSvI2oilfuBffeHqdC98vONvlA/K/d3GaVMP8z1bTgGm2ewtvs7Ww/MxRAdVm2LQ1xUVRxyUCv+ecHQaM8l3JAyVVm30a0+5zmE/kvqcnWpiU5n43f7SVPCL+lXdq18wjk/KmlaggHh1voHbm0/Uyp5f06tHqFDMdmVhAO3h39gmOfQUiLMSy+zmBTnT9E4wOwN2iPwjmCh2FpaL1BsV7km3ZYkC5GXr+gqiRA0Pr1Zg2Df+LyeOX/rsweWmzOWWC74QldyP/P2BFws96GIPrrfYBF1sOkYYYw4Kdez8bmXLXx51IYM1+dS4mdw43+5wd/wzUNzAk=" # Wrong Setup Auth Service Id
    - script:
      - npx lerna bootstrap
      - npx lerna run build --parallel --stream
      - npx lerna run test:html5 --stream
      name: "HTML5 Integration Tests"
      # if: type IN (pull_request)
      env:
      - secure: "UQrt4bpePsVABHrUPmhJc3jA7c0GqBH+EJtcWt2VXRwMNrva3URr1L1xRZTbjRFYtDH0dZo3VdlHwDjm44o97cjiL6d7x2Y7UZ2eDApj6IKptPe0ht/qP0zDUPtd1ttsCC/jtZXacpTHXY85N6xqbtCZg4hhWe1/v1a7yWSAwe+bEoXveOuk9W5TCqcqFZxjKZupKIIGv50abJ3B4BXdunBGPIT/6UImuzp5UnzCzWrdHVfyDn0NU4WRy+bAcAbE/XMOGgRF8Srld5nZFNQwer5eUgtm/TFpjhfK/8USfdiQQDeIo2DtUGpykvkbqrgygf3+IpDMHH7LE6U8/4j+t3Wucq9TfLUVwElPXS6LIfKvImVp96IoLrvpUYF77g4t+0CxdjEh8mZE3JnCz3/42DlSiZsEpTF2iyrB+bbLJ6OdZxuo69JpyBxD5RAsC3736lQZpVqcvlskC7g0yrPsBcoX5GXwN8jMUxZ54nPScEd3N0cCbf/EfxPrziEvqcDDC5nxbwjxjRACuhu/DZWNLIxU1kyk3VsTG57IcKoFOjTaLLMYcSViyK5DDHFlUuBqfJf5rDBrGdekDNvtpKsKp24+6fL98Ly3vUdniXJzhW3ruy67e1LnaKPDOHYtPpgD8kKx1vRM/rzzN+jaL63uLGIBrxAbqPWhf/l6VH/13YI=" # App Key
      - secure: "lJdytBKd5SkybCzuOPO23qZb3YHo9B1jkG3zdL8jHk67hg0GLhxeAE+xQ2qeCyonQzQ+8SSCBmFDfar7yLFityfVun/lTINFkdRkvfpvfxqkZoyegxILUOlqEzHATG8ler9JThDfQ/NgmfcvP3plN84kXD+uU2QC1LfEuDeQUfvIHxL82ckuKObunIZ+PP/58qa1eRhxvqN0ERY+iPxWcGS8006I0PMdcyKVqOc8SQBC1ND5Xw0VmMKye4fBtGRUmYD7niG9gxgDyEdmuBdG4CAxn0LwP+WgwUE94l+jsh8gT1QxHZcEt9plF1VeaoN/ekr5DVNE7/k/IFzzCo3GF7LIqqbFA39MtRGA+UCgHBGvEiEMz0rxZi0AnT0w301lZ+e/sf723JvJ2M72gt/xNwx4EkIz9ppQGHJRPJM/uJZHifBlr1yCkKDJ05SvuY1kqEJLiGyOquMt1SKqQGDwzh/PL6cigay9q8Y4WEayIjPMpzgA/DW1Jij+y/3nKf3sCk3e1syKJxYUxOXwlS0AqVFQ0IK7udKsyDlTiBpDJeP80g5l2IJaXcaBfDVUZvlL0+GgkRw95poQkLFfwymrRt6wTjgQJCDNy+SuzPebq6i0lFTE/HfAjrxwJvwLKPE6sT9mT7XvCFjv9m+u7W9eMenyIhQjzS03Sk5agxQpMMM=" # App Secret
      - secure: "dlsSmfZDM6jQpzq1IpFRITjKtEpkB9OchGcCTtHyKsxN05ZCoii42XDyIzMdGAL/pKlIo8VBe/ZmJeKFNsf8udNnfZbxqWR+jAspGQWjQJMBPXcCj/CcP4Ox6rsFaKkpqA5VVDrqCO0vOLuEXX3LhGmgAjfLzFpebPUcdBsGdhXLomYFZB7AwgtNWRq4WUgWrHCmI2yNMaE072W4rLbelgdDtwMbmFjTB9q6/mNzj2/iOfv70E7HJQLzKcMA3yrHS9uRlDgkrMhubZeMJSgvcAMDZIdjcFL7ST0dcNrD+sQBVSeini1G71wVYfH2csB5EP1Qfbq9QyQiu0BTkLudf2rPFAKQMUcWW6b/x/xnjYM3ogcvLpxURQwNscRaS1JOaIfWzFvf9kl4oqvx8bU3mJBtQH5bWVBnFE+CJ6DhGkmGrIHbgFy+nOuqjFzndkxreukMeVVd3kTe1N7D4ZrwiVBqB/ygvcnQEm2FQQusQ8okDEvOhSo+rBdCguF7bkGuQjXE+DlRgMys0vV4XVaDpBjxI69XzlXeNCo1eycPFrPz6gdvwjuKkTmiI3lgKmPm4SWrCJfatbZ3avWbcj3Z1rbCTrL4UPi8xYIKYSSeVVww87IBNkUrPhErgOFK0o0Aohuvr+g8stqoOI/gHbsEdajWtQHqvTBWrK3nu2AGX4U=" # Master Secret
      - secure: "NPpRy7TySoWvDKIFl+Y4olOPpultDc3ersSgdkQAFu6bMEbwOB6k2AC9YM5OG12mriFcAd5t2iHsD2LQal8QhaojWV1voNi4G7EqaFOGlYzMVE+3WI17PTnQ/y7LBEU2Z2py/2fTF8eBuMaYvcsgE/d6bx8ECWunIOFVsPgXRCvbtKIhfVAZkRBbgFS+D2x3f6GjC36e+c6O7noCM25S546DbhJWw+LivDjTsyFuuK61V+A2DTqvENyvfaZ9r7FQlRl6A8gLLWHSuzMoAltYSsoBPF0aYaJfPwctE1A4x0r9+UPu63eNa/t5t9/Int5nqwwgQNphVQrHRMZV1b0WyiuhZW+fLBClzG2d05LQDnFjSqULyHmfDkfHohQ3bWy9VoaNHUpFiEDHJCFYJudQdktEm5Iwa/2X98BKFLC088dFCcEK0z08HLQ/JIrZ4znGoR2SxwdEOdt36kLTrqAk5hrqxwb8z0ePCBXzN2bQfbDuNKthUeOxYZZt1o6MP77ep4hg5MoHT1mtafiM/Il0v4so2VYlSSIN/sO6IgV4Qr4iM3m003ps97D84DnlL6SiIPtwrq+GqpAF4TAQd487vwVJKa1i/3ph6790vxgB9BptDE+P5eEuq6rWj/P8rqnAJb7zIR3UP4kP0zTAyuQsiLpxjdHLWv7SL1pjaa4qC1E=" # Auth Service Id
      - secure: "NU1x1DJ4GV+bx58cvhNrT97EGLHOxbikANhkApVKnlTQeMDwpVas2/PoeYm/3t6fpdE7etQYVdTuJ1WtftWHRLmu0MoRU9ly+6qr+AvWh9j2sMrqcj1EmeZUwyE4REI2GetpSVFE7SajdC0ejXotanFuWASJVov5meK+6wn3acNt8hJPrHv71uHzvPDK9Xga+0IaJlXo4E5/WLhQM0ZeIlDANvTgFpmHLNyx9kP9b8hi29gXzCYWKinfP+9QfbKVCDXacGVzOKcvMbFf+6z7LE3XqobHtJ20bO0weF8AyHh/kfO6C8kT6OJ8KDOE1mfkggzxSKoEvrc2OwajIXOaHSjzQL9KycJyHAT7MWiwZemEgqNqAl4LygKl26UqkS5f/ADpucfjQVf3kRAcgsRnF8/+lF75n+8oRjxnj2tVsljXySRl8Y6+l/eHkWwxsJqwytJjCfUnT9uqiLInDpbfaBb7XEbpU9sBEB3I9lz2CTumlqYxpq56aOEhhIhlJ3qk7JOJRL8Nlcfk9ag+CZejoSEL8YZdCsDKNPtUtaPy6QDAxVVLfV7oULqfaILiqkUTnL0Ghrxs1p9TRX5KXb2tUKM7/QbTA8o3BsIQlNy8ECgLIZmFmwNG8a/SiRUnXZn8oIXYpYYFQUJF4cxTCu3Mvm2bDNHWS9c75xv6W/80eYU=" # No Refresh Token Auth Service Id
      - secure: "OwzgQ55o96AiijQkqQfDxPQJzNWBueZl8VwwFZfDYcJpOsKitxVGRohkrY9mJ9VJp6ocyfpAgFjqQgo7+MCi5nFi3Xmy2xNScLgkznJ3ONeFpNk4BNiaNHHeXY2qmHzcBoM//FLcuJv2B0gUgHJYGhuw1VhLqsWYcgoY6OpVG8trjEPgDzKZzJsPIGVowl4pb1bpGmS0OxS8T0+YpumSqQFTZYEYv7hI6kWf/zKkEXChZfvcVfmaxOUnErlKz/VpcCxNuAOKSrByiucbzj/YUBhFCzldLGMV+KxmtwtfrlkhFRCV0s+5RSDjnA04p0r90W5XBGuvtQBEybr8e6WKZmHwd3nR/6bSQYNpiqwzTJaH1ywxxuRqI6cIEh+Cg1CCTVuPxhhF9KDpe+T14MM8iofhHMW5tWRwVrVhvZu/8dKHRzZ7bFzOjBwpPSnDjYduPtd+sjNqiifer5YVDvD525kETa9L67yRM8MhB7XFmjjbE37nnXl8y10w6NzQuTyZyHyYYAFN3DVybxVmhfHoQz3+F3nEjSybXkgoOdKXQXivkgKGFb8DMRI98R8zByFK2IAuVh5h1AtJwtiwd8JGJk5rdEsyNBnQB80pg+0JMECFIDA4Q7gSLGfVyUbNFGErlQbO3fntsCRplF/+JBGto9PYw5LBXAZe4vWN4Dh5j6A=" # Wrong Setup Auth Service Id
