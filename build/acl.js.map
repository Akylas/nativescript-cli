{"version":3,"sources":["acl.js"],"names":[],"mappings":"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","file":"acl.js","sourcesContent":["import { KinveyError } from './errors';\nimport isPlainObject from 'lodash/isPlainObject';\nconst aclAttribute = process.env.KINVEY_ACL_ATTRIBUTE || '_acl';\n\n/**\n * Wrapper for reading and setting permissions on an entity level.\n *\n * @example\n * var entity = { _acl: {} };\n * var acl = new Kinvey.Acl(entity);\n */\nexport class Acl {\n  constructor(entity = {}) {\n    if (!isPlainObject(entity)) {\n      throw new KinveyError('entity argument must be an object');\n    }\n\n    /**\n     * The kmd properties.\n     *\n     * @private\n     * @type {Object}\n     */\n    this.acl = entity[aclAttribute];\n  }\n\n  get creator() {\n    return this.acl.creator;\n  }\n\n  get readers() {\n    return this.acl.r || [];\n  }\n\n  get writers() {\n    return this.acl.w || [];\n  }\n\n  get readerGroups() {\n    return this.acl.groups ? this.acl.groups.r : [];\n  }\n\n  get writerGroups() {\n    return this.acl.groups ? this.acl.groups.w : [];\n  }\n\n  set globallyReadable(gr) {\n    this.acl.gr = gr || false;\n  }\n\n  set globallyWritable(gw) {\n    this.acl.gw = gw || false;\n  }\n\n  addReader(user) {\n    const r = this.acl.r || [];\n\n    if (r.indexOf(user) === -1) {\n      r.push(user);\n    }\n\n    this.acl.r = r;\n    return this;\n  }\n\n  addReaderGroup(group) {\n    const groups = this.acl.groups || {};\n    const r = groups.r || [];\n\n    if (r.indexOf(group) === -1) {\n      r.push(group);\n    }\n\n    groups.r = r;\n    this.acl.groups = groups;\n    return this;\n  }\n\n  addWriter(user) {\n    const w = this.acl.w || [];\n\n    if (w.indexOf(user) === -1) {\n      w.push(user);\n    }\n\n    this.acl.w = w;\n    return this;\n  }\n\n  addWriterGroup(group) {\n    const groups = this.acl.groups || {};\n    const w = groups.w || [];\n\n    if (w.indexOf(group) === -1) {\n      w.push(group);\n    }\n\n    groups.w = w;\n    this.acl.groups = groups;\n    return this;\n  }\n\n  isGloballyReadable() {\n    return this.acl.gr || false;\n  }\n\n  isGloballyWritable() {\n    return this.acl.gw || false;\n  }\n\n  removeReader(user) {\n    const r = this.acl.r || [];\n    const pos = r.indexOf(user);\n\n    if (pos !== -1) {\n      r.splice(pos, 1);\n    }\n\n    this.acl.r = r;\n    return this;\n  }\n\n  removeReaderGroup(group) {\n    const groups = this.acl.groups || {};\n    const r = groups.r || [];\n    const pos = r.indexOf(group);\n\n    if (pos !== -1) {\n      r.splice(pos, 1);\n    }\n\n    groups.r = r;\n    this.acl.groups = groups;\n    return this;\n  }\n\n  removeWriter(user) {\n    const w = this.acl.w || [];\n    const pos = w.indexOf(user);\n\n    if (pos !== -1) {\n      w.splice(pos, 1);\n    }\n\n    this.acl.w = w;\n    return this;\n  }\n\n  removeWriterGroup(group) {\n    const groups = this.acl.groups || {};\n    const w = groups.w || [];\n    const pos = w.indexOf(group);\n\n    if (pos !== -1) {\n      w.splice(pos, 1);\n    }\n\n    groups.w = w;\n    this.acl.groups = groups;\n    return this;\n  }\n\n  toJSON() {\n    return this.acl;\n  }\n}\n"],"sourceRoot":"/source/"}